digraph evmnative {
  compound=true
  subgraph clustereth {
    label="EVM Blockchain"
  token [shape=rectangle, label="Erc20 Token Contract", height=1, width=1]
  bridgebank [shape=none, label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
  <TR>
    <TD>Bridge Bank</TD>
  </TR>
  <TR>
    <TD BGCOLOR="lightgray" PORT="lock">Lock()</TD>
  </TR>
    <TR>
    <TD BGCOLOR="lightgray" PORT="burn">Burn()</TD>
  </TR>
</TABLE>>]
  cosmosbridge [shape=none, label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
  <TR>
    <TD>Cosmos Bridge</TD>
  </TR>
  <TR>
    <TD BGCOLOR="lightgray" PORT="submit">submitProphecyClaimAggregatedSigs()</TD>
  </TR>
    <TR>
    <TD BGCOLOR="lightgray" PORT="submitBatch">submitBatchProphecyClaimAggregatedSigs()</TD>
  </TR>
</TABLE>>]
  }
  subgraph clustersif {
    label="Sifchain Blockchain"
    bank [shape=none, label=<
    <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
  <TR>
    <TD>Bank Module</TD>
  </TR>
  <TR>
    <TD BGCOLOR="lightgray" PORT="mint">MintCoins()</TD>
  </TR>
    <TR>
    <TD BGCOLOR="lightgray" PORT="burn">BurnCoins()</TD>
  </TR>
      <TR>
    <TD BGCOLOR="lightgray" PORT="toModule">SendCoinsFromAccountToModule()</TD>
  </TR>
      <TR>
    <TD BGCOLOR="lightgray" PORT="fromModule">SendCoinsFromModuleToAccount()</TD>
  </TR>
</TABLE>
    >]
    ethbridge [shape=none, label=<
    <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
  <TR>
    <TD>EthBridge Module</TD>
  </TR>
  <TR>
    <TD BGCOLOR="lightgray" PORT="lock">Lock()</TD>
  </TR>
    <TR>
    <TD BGCOLOR="lightgray" PORT="burn">Burn()</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="setEthNonce">SetEthereumLockBurnSequence()</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="getEthNonce">GetEthereumLockBurnSequence()</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="updateNonce">UpdateGlobalSequence()</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="getNonce">GetGlobalSequence()</TD>
  </TR>
</TABLE>
    >]
        oracle [shape=none, label=<
    <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
  <TR>
    <TD>Oracle Module</TD>
  </TR>
    <TR>
    <TD BGCOLOR="lightgray" PORT="claim">ProcessClaim()</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="getTransaction">GetProphecyInfoWithScopeGlobalSequence()</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="setTransaction">SetGlobalNonceProphecyID()</TD>
  </TR>
</TABLE>
    >]
        metadata [shape=none, label=<
    <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
  <TR>
    <TD>Token Registry Module</TD>
  </TR>
  <TR>
    <TD BGCOLOR="lightgray" PORT="add">AddTokenMetadata()</TD>
  </TR>
    <TR>
    <TD BGCOLOR="lightgray" PORT="get">GetTokenMetadata()</TD>
  </TR>
 <TR>
    <TD BGCOLOR="lightgray" PORT="addIBC">AddIBCTokenMetadata()</TD>
  </TR>
     <TR>
    <TD BGCOLOR="lightgray" PORT="isIBC">IsIBCToken()</TD>
  </TR>
</TABLE>
    >]
  }  relayer [shape=Mcircle, label="Relayer"]
  witness [shape=Mcircle, label="Witness"]
  user [shape=Mdiamond, label="User"]
  sifClaim [shape=none, label=<
  <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
  <TR>
    <TD>ProphecyInfo</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="network">Prophecy Id</TD>
  </TR>
  <TR>
  <TD BGCOLOR="lightgray" PORT="sequence">Cosmos Sender</TD>
  </TR>
  <TR>
    <TD BGCOLOR="lightgray" PORT="denom">Cosmos Sequence Number</TD>
  </TR>
    <TR>
    <TD BGCOLOR="lightgray" PORT="value">EVM Reciever</TD>
  </TR>
      <TR>
    <TD BGCOLOR="lightgray" PORT="value">Token Denom Hash</TD>
  </TR>    
  <TR>
    <TD BGCOLOR="lightgray" PORT="value">Token Contract Address</TD>
  </TR>    
  <TR>
    <TD BGCOLOR="lightgray" PORT="value">Token Amount</TD>
  </TR>
      <TR>
    <TD BGCOLOR="lightgray" PORT="value">EVM Signatures</TD>
  </TR>
</TABLE>
  >]

  user -> ethbridge:lock [label="User initiates lock"]
  ethbridge:lock -> bank:toModule [label="Ethbridge locks coins" ]
  ethbridge -> witness [label="LogLockEvent is emited", ltail="clustersif"]
  witness -> ethbridge:getNonce [label="On wakeup get sequence", dir=both]
  witness -> sifClaim [label="Construct Prophecy Claim" ]
  sifClaim -> oracle:setTransaction [label="Store signed claim into virtual mempool" ]
  relayer -> ethbridge:getNonce [label="On wakeup get sequence", dir=both]
  relayer -> oracle:getTransaction [label="Get latest claim to transmit", dir=both]
  relayer -> cosmosbridge:submitBatch [label="Transmit signed claim to cosmos bridge" ]
  relayer -> ethbridge:setNonce [label="After transmiting claim, update sequence number"]
  cosmosbridge -> bridgebank [label="Request minting of asset"]
  bridgebank -> token [label="Deploy and/or mint bridge tokens"]


}
